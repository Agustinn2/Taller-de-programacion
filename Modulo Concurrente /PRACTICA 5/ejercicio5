programa ejercicio5
procesos
  proceso recolectarPapeles (E cantPapeles:numero)
  variables
    miCa,miAv:numero
  comenzar
    miCa:=PosCa
    miAv:=PosAv
    repetir cantPapeles
      BloquearEsquina (100,1)
      Pos(100,1)
      tomarPapel
      Pos(miAv,miCa)
      LiberarEsquina(100,1)  
  fin
  proceso depositarPapeles(E cantPapeles:numero)
  comenzar
    repetir cantPapeles
      depositarPapel
  fin
  proceso entregarPapeles(ES terminados:numero )
  variables
    papeles,ID:numero
  comenzar
    Random(papeles,1,5)
    RecibirMensaje(ID, *)
    si(ID = 1)
      dejarPapeles(papeles)
      EnviarMensaje(papeles,r1)
    sino
      si(ID = 2)
        dejarPapeles(papeles)
        EnviarMensaje(papeles,r2)
      sino
        si(ID = 3)
          dejarPapeles(papeles)
          EnviarMensaje(papeles,r3)
        sino
          terminados:= terminados + 1
  fin
  proceso dejarPapeles (E cant:numero)
  variables
    av,ca:numero
  comenzar
    av:=PosAv
    ca:=PosCa
    BloquearEsquina(100,1)
    Pos(100,1)
    depositarPapeles(cant)
    Pos(av,ca)
    LiberarEsquina(100,1)
  fin
  proceso enviarIds
  comenzar
    EnviarMensaje(1,r1)
    EnviarMensaje(2,r2) 
    EnviarMensaje(3,r3) 
  fin
areas
  areaR1: AreaP (10,1,10,1)
  areaR2: AreaP (11,1,11,1)
  areaR3: AreaP (12,1,12,1)
  areaServidor: AreaP (13,1,13,1)
  areaDeposito: AreaC (100,1,100,1)
robots
  robot cliente
  variables
    cantPapeles,ID:numero
  comenzar
    RecibirMensaje(ID ,r0)
    repetir 4
      EnviarMensaje(ID,r0)
      RecibirMensaje(cantPapeles,r0)
      recolectarPapeles(cantPapeles)
      depositarPapeles(cantPapeles)
    EnviarMensaje(0,r0)
  fin
  robot servidor
  variables
    terminados:numero
  comenzar
    terminados:=0
    enviarIds
    mientras (terminados <> 3)
      entregarPapeles(terminados)  
  fin
variables
  r1,r2,r3: cliente
  r0: servidor
comenzar
  AsignarArea(r1, areaR1)
  AsignarArea(r2, areaR2)
  AsignarArea(r3, areaR3)
  AsignarArea(r0, areaServidor)
  AsignarArea(r1, areaDeposito)
  AsignarArea(r2, areaDeposito)
  AsignarArea(r3, areaDeposito)
  AsignarArea(r0, areaDeposito)
  Iniciar(r1, 10,1)
  Iniciar(r2, 11,1)
  Iniciar(r3, 12,1)
  Iniciar(r0, 13,1)
fin